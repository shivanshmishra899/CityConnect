<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransitFlow - Real-Time Bus Tracking</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo" crossorigin=""></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">

    <!-- Firebase SDKs -->
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            scroll-behavior: smooth;
        }

        .hidden {
            display: none;
        }

        #map {
            height: 100vh;
            width: 100vw;
            z-index: 0;
        }

        .bus-icon-div {
            width: 36px;
            height: 36px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: white;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s;
            border: 2px solid #4285F4;
        }

        .bus-stop-icon-div {
            width: 14px;
            height: 14px;
            background-color: rgba(0, 0, 0, 0.7);
            border: 2px solid white;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .auth-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Animation Styles */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .animate-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        .faq-answer,
        .signup-fields {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, opacity 0.3s ease-in-out, margin-top 0.4s ease-in-out;
            opacity: 0;
        }

        .signup-fields.expanded {
            max-height: 200px;
            /* Adjust as needed */
            opacity: 1;
        }

        #auth-form-container {
            transition: height 0.5s ease-in-out;
        }
    </style>
</head>

<body class="bg-white">

    <!-- App Screens -->
    <div id="loading-screen" class="h-screen w-screen flex flex-col justify-center items-center bg-white">
        <div class="loader"></div>
        <p class="mt-4 text-lg font-semibold text-gray-700">Connecting...</p>
    </div>

    <div id="home-screen" class="hidden">
        <div class="bg-gray-50 min-h-screen">
            <header class="bg-white shadow-sm sticky top-0 z-20">
                <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
                    <h1 class="text-2xl font-bold text-gray-800">TransitFlow</h1>
                    <div>
                        <button id="home-login-btn"
                            class="bg-indigo-600 text-white px-5 py-2 rounded-full font-semibold hover:bg-indigo-700 transition-colors">
                            Login / Sign Up
                        </button>
                        <button id="home-profile-btn"
                            class="hidden flex items-center space-x-2 text-gray-700 hover:text-indigo-600">
                            <span class="font-semibold">My Profile</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </button>
                    </div>
                </nav>
            </header>
            <main>
                <section class="bg-indigo-700 text-white text-center py-20 px-6"
                    style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url(https://placehold.co/1920x1080/667eea/ffffff?text=City+Bus&font=inter); background-size: cover; background-position: center;">
                    <h2 class="text-5xl font-extrabold mb-4 animate-on-scroll">Welcome to Smart Transit</h2>
                    <p class="text-xl mb-8 max-w-2xl mx-auto animate-on-scroll" style="transition-delay: 100ms;">
                        Real-time tracking, easy ticketing, and transport planning. All in one place.</p>
                    <a href="#features"
                        class="bg-white text-indigo-600 px-8 py-4 rounded-full font-bold shadow-lg transform hover:scale-105 transition-transform animate-on-scroll"
                        style="transition-delay: 200ms;">
                        Get Started
                    </a>
                </section>

                <section id="features" class="py-20 bg-gray-50">
                    <div class="container mx-auto px-6">
                        <div class="text-center mb-12 animate-on-scroll">
                            <h2 class="text-4xl font-bold text-gray-800">Everything You Need</h2>
                            <p class="text-gray-600 mt-2">All the tools for a stress-free commute.</p>
                        </div>
                        <div class="grid md:grid-cols-3 gap-8">
                            <div
                                class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 transform hover:-translate-y-1 animate-on-scroll">
                                <div class="text-indigo-500 mb-4">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z">
                                        </path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                </div>
                                <h3 class="text-xl font-bold text-gray-800 mb-2">Track your Vehicle</h3>
                                <p class="text-gray-600 mb-4">See your bus move on the map in real-time. No more
                                    guessing, no more waiting.</p>
                                <button data-target="track-vehicle"
                                    class="feature-card-btn font-semibold text-indigo-600 hover:text-indigo-800 transition-colors">Track
                                    a Bus →</button>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 transform hover:-translate-y-1 animate-on-scroll"
                                style="transition-delay: 100ms;">
                                <div class="text-indigo-500 mb-4">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 00-2-2H5z">
                                        </path>
                                    </svg>
                                </div>
                                <h3 class="text-xl font-bold text-gray-800 mb-2">Book Tickets</h3>
                                <p class="text-gray-600 mb-4">Purchase your bus tickets digitally. Skip the lines and go
                                    paperless.</p>
                                <button data-target="book-tickets"
                                    class="feature-card-btn font-semibold text-indigo-600 hover:text-indigo-800 transition-colors">Book
                                    Now →</button>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 transform hover:-translate-y-1 animate-on-scroll"
                                style="transition-delay: 200ms;">
                                <div class="text-indigo-500 mb-4">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 4v6m3-3h-6"></path>
                                    </svg>
                                </div>
                                <h3 class="text-xl font-bold text-gray-800 mb-2">Find Transport</h3>
                                <p class="text-gray-600 mb-4">Enter your destination to see all available routes,
                                    timings, and fare estimates.</p>
                                <button data-target="find-transport"
                                    class="feature-card-btn font-semibold text-indigo-600 hover:text-indigo-800 transition-colors">Find
                                    a Route →</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="py-20 bg-white">
                    <div class="container mx-auto px-6">
                        <div class="text-center mb-12 animate-on-scroll">
                            <h2 class="text-4xl font-bold text-gray-800">How It Works</h2>
                            <p class="text-gray-600 mt-2">Get started in three simple steps.</p>
                        </div>
                        <div class="grid md:grid-cols-3 gap-12 text-center">
                            <div class="animate-on-scroll">
                                <div
                                    class="bg-indigo-100 text-indigo-600 w-20 h-20 rounded-full flex items-center justify-center mx-auto text-3xl font-bold mb-4">
                                    1</div>
                                <h3 class="text-xl font-bold text-gray-800 mb-2">Create an Account</h3>
                                <p class="text-gray-600">Sign up for free to get access to all features.</p>
                            </div>
                            <div class="animate-on-scroll" style="transition-delay: 150ms;">
                                <div
                                    class="bg-indigo-100 text-indigo-600 w-20 h-20 rounded-full flex items-center justify-center mx-auto text-3xl font-bold mb-4">
                                    2</div>
                                <h3 class="text-xl font-bold text-gray-800 mb-2">Find Your Route</h3>
                                <p class="text-gray-600">Select your bus route or search by vehicle number.</p>
                            </div>
                            <div class="animate-on-scroll" style="transition-delay: 300ms;">
                                <div
                                    class="bg-indigo-100 text-indigo-600 w-20 h-20 rounded-full flex items-center justify-center mx-auto text-3xl font-bold mb-4">
                                    3</div>
                                <h3 class="text-xl font-bold text-gray-800 mb-2">Track in Real-Time</h3>
                                <p class="text-gray-600">Watch your bus move live on the map and plan your arrival.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="py-20 bg-gray-50">
                    <div class="container mx-auto px-6 max-w-4xl">
                        <div class="text-center mb-12 animate-on-scroll">
                            <h2 class="text-4xl font-bold text-gray-800">Frequently Asked Questions</h2>
                        </div>
                        <div class="space-y-4">
                            <div class="bg-white rounded-lg shadow-md animate-on-scroll">
                                <div class="faq-question cursor-pointer p-6 flex justify-between items-center">
                                    <h3 class="text-lg font-semibold text-gray-800">Is this service free to use?</h3>
                                    <span class="text-indigo-500 transform transition-transform duration-300">▼</span>
                                </div>
                                <div class="faq-answer px-6 pb-6 text-gray-600">
                                    <p>Yes, the tracking and route finding features are completely free for all
                                        commuters. Standard charges may apply for booking tickets through the app.</p>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg shadow-md animate-on-scroll">
                                <div class="faq-question cursor-pointer p-6 flex justify-between items-center">
                                    <h3 class="text-lg font-semibold text-gray-800">How accurate is the bus tracking?
                                    </h3>
                                    <span class="text-indigo-500 transform transition-transform duration-300">▼</span>
                                </div>
                                <div class="faq-answer px-6 pb-6 text-gray-600">
                                    <p>Our system uses GPS devices installed on each bus, providing location updates
                                        every 5-10 seconds. This is highly accurate and accounts for traffic and other
                                        delays in real-time.</p>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg shadow-md animate-on-scroll">
                                <div class="faq-question cursor-pointer p-6 flex justify-between items-center">
                                    <h3 class="text-lg font-semibold text-gray-800">Which cities are covered?</h3>
                                    <span class="text-indigo-500 transform transition-transform duration-300">▼</span>
                                </div>
                                <div class="faq-answer px-6 pb-6 text-gray-600">
                                    <p>We are currently launching in select tier-2 cities and expanding rapidly. Please
                                        check the app for a full list of supported locations.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

            </main>
            <footer class="bg-gray-800 text-white py-6">
                <div class="container mx-auto px-6 text-center">
                    <p>&copy; 2025 TransitFlow. All Rights Reserved.</p>
                </div>
            </footer>
        </div>
    </div>

    <div id="auth-screen" class="hidden auth-container h-screen w-screen flex flex-col justify-center items-center p-4">
        <button id="auth-back-btn" class="absolute top-12 left-6 z-10 flex flex-row items-center">
            <p class="text-white text-lg">← Go Back</p>
        </button>
        <p class="text-5xl font-extrabold text-white mb-8">TransitFlow</p>
        <div id="auth-form-container"
            class="w-full max-w-md bg-white/10 backdrop-blur-md p-8 rounded-2xl border border-white/20">
            <div class="mb-6">
                <div class="flex border border-white/30 rounded-lg p-1">
                    <button data-role="traveller"
                        class="role-toggle-btn w-1/3 py-2 text-white rounded-md active">Traveller</button>
                    <button data-role="driver" class="role-toggle-btn w-1/3 py-2 text-white rounded-md">Driver</button>
                    <button data-role="conductor"
                        class="role-toggle-btn w-1/3 py-2 text-white rounded-md">Conductor</button>
                </div>
            </div>
            <h2 id="auth-title" class="text-3xl font-bold text-white text-center mb-6">Welcome Back</h2>
            <div id="auth-error-message" class="bg-red-500/50 text-white text-center p-2 rounded-lg mb-4 hidden"></div>
            <div class="space-y-4">
                <div id="signup-fields" class="signup-fields space-y-4">
                    <input id="auth-fullname" placeholder="Full Name"
                        class="w-full p-3 bg-white/20 text-white placeholder-gray-300 rounded-lg" type="text" />
                </div>
                <input id="auth-email" placeholder="Email Address"
                    class="w-full p-3 bg-white/20 text-white placeholder-gray-300 rounded-lg" type="email" />
                <input id="auth-password" placeholder="Password"
                    class="w-full p-3 bg-white/20 text-white placeholder-gray-300 rounded-lg" type="password" />
                <div id="signup-fields-confirm" class="signup-fields">
                    <input id="auth-confirm-password" placeholder="Confirm Password"
                        class="w-full p-3 bg-white/20 text-white placeholder-gray-300 rounded-lg" type="password" />
                </div>
                <div id="staff-fields" class="staff-fields space-y-4">
                    <input id="auth-vehicle-number" placeholder="Vehicle Number (e.g., KA01F1234)"
                        class="w-full p-3 bg-white/20 text-white placeholder-gray-300 rounded-lg uppercase"
                        type="text" />
                </div>
            </div>
            <button id="auth-submit-btn" class="w-full mt-6 py-3 bg-white rounded-lg flex justify-center items-center">
                <span id="auth-submit-text" class="text-indigo-600 text-lg font-bold">Log In</span>
                <div id="auth-loader" class="loader hidden"></div>
            </button>
            <button id="auth-toggle-btn" class="w-full">
                <p class="text-white/80 text-center mt-6">Don't have an account? <span class="font-bold text-white">Sign
                        Up</span></p>
            </button>
        </div>
    </div>

    <div id="map-screen" class="hidden h-screen w-screen">
        <div id="map"></div>
        <div class="absolute top-0 left-0 right-0 p-4 pt-8 bg-gradient-to-b from-black/50 to-transparent z-[1000]">
            <div class="flex justify-between items-center">
                <button id="map-home-btn" class="bg-white/90 px-4 py-2 rounded-full shadow-lg font-semibold">←
                    Home</button>
                <button id="map-profile-btn" class="bg-white/90 px-4 py-2 rounded-full shadow-lg font-semibold">My
                    Profile</button>
            </div>
            <div id="route-buttons" class="mt-4 flex overflow-x-auto space-x-2 pb-2">
                <!-- Route buttons will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <div id="profile-screen" class="hidden h-screen w-screen bg-gray-100">
        <div class="container mx-auto max-w-2xl py-12 px-4">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800">My Profile</h1>
                <button id="profile-back-btn"
                    class="font-semibold text-indigo-600 hover:text-indigo-800 transition-colors">← Back to
                    Home</button>
            </div>
            <div class="bg-white p-8 rounded-lg shadow-md">
                <div class="space-y-4">
                    <div>
                        <label class="text-sm font-medium text-gray-500">Full Name</label>
                        <p id="profile-name" class="text-lg font-semibold text-gray-800">-</p>
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-500">Email Address</label>
                        <p id="profile-email" class="text-lg font-semibold text-gray-800">-</p>
                    </div>
                </div>
                <hr class="my-6">
                <button id="profile-logout-btn"
                    class="w-full py-3 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition-colors">
                    Logout
                </button>
            </div>
        </div>
    </div>

    <div id="book-tickets-screen" class="hidden h-screen w-screen bg-gray-100">
        <div class="container mx-auto max-w-2xl py-12 px-4">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800">Book a Ticket</h1>
                <button id="tickets-back-btn"
                    class="font-semibold text-indigo-600 hover:text-indigo-800 transition-colors">← Back to
                    Home</button>
            </div>
            <div class="bg-white p-8 rounded-lg shadow-md">
                <div class="space-y-4">
                    <div>
                        <label for="from-stop" class="text-sm font-medium text-gray-700">From</label>
                        <select id="from-stop"
                            class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm"></select>
                    </div>
                    <div>
                        <label for="to-stop" class="text-sm font-medium text-gray-700">To</label>
                        <select id="to-stop"
                            class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm"></select>
                    </div>
                    <div>
                        <label for="travel-date" class="text-sm font-medium text-gray-700">Date of Travel</label>
                        <input type="date" id="travel-date"
                            class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                    </div>
                </div>
                <hr class="my-6">
                <button id="search-buses-btn"
                    class="w-full py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition-colors">
                    Search Buses
                </button>
                <div id="ticket-results" class="mt-6"></div>
            </div>
        </div>
    </div>

    <div id="find-transport-screen" class="hidden h-screen w-screen bg-gray-100">
        <div class="container mx-auto max-w-2xl py-12 px-4">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800">Find Transport</h1>
                <button id="find-transport-back-btn"
                    class="font-semibold text-indigo-600 hover:text-indigo-800 transition-colors">← Back to
                    Home</button>
            </div>
            <div class="bg-white p-8 rounded-lg shadow-md">
                <div class="space-y-4">
                    <div>
                        <label for="pickup-location" class="text-sm font-medium text-gray-700">Pickup Location</label>
                        <input type="text" id="pickup-location" placeholder="e.g., Central Station"
                            class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                    </div>
                    <div>
                        <label for="drop-location" class="text-sm font-medium text-gray-700">Drop Location</label>
                        <input type="text" id="drop-location" placeholder="e.g., Tech Park"
                            class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                    </div>
                </div>
                <hr class="my-6">
                <button id="find-routes-btn"
                    class="w-full py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition-colors">
                    Find Routes
                </button>
                <div id="find-transport-results" class="mt-6"></div>
            </div>
        </div>
    </div>

    <div id="track-vehicle-screen" class="hidden h-screen w-screen bg-gray-100">
        <div class="container mx-auto max-w-2xl py-12 px-4">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800">Track a Vehicle</h1>
                <button id="track-vehicle-back-btn"
                    class="font-semibold text-indigo-600 hover:text-indigo-800 transition-colors">← Back to
                    Home</button>
            </div>
            <div class="bg-white p-8 rounded-lg shadow-md">
                <div class="space-y-4">
                    <div>
                        <label for="vehicle-number-input" class="text-sm font-medium text-gray-700">Vehicle
                            Number</label>
                        <input type="text" id="vehicle-number-input" placeholder="e.g., KA01F1234"
                            class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm uppercase">
                    </div>
                </div>
                <hr class="my-6">
                <button id="track-vehicle-submit-btn"
                    class="w-full py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition-colors">
                    Track Bus
                </button>
                <div id="track-vehicle-results" class="mt-4 text-center"></div>
                <div class="mt-6 text-center">
                    <p class="text-gray-600">Don't know the vehicle number?</p>
                    <button id="track-vehicle-find-route-btn"
                        class="font-semibold text-indigo-600 hover:text-indigo-800 transition-colors">Find a route
                        instead →</button>
                </div>
            </div>
        </div>
    </div>
    <div id="staff-profile-screen" class="hidden h-screen w-screen bg-gray-100">
        <div class="container mx-auto max-w-4xl py-12 px-4">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800">Staff Dashboard</h1>
                <button id="staff-profile-logout-btn"
                    class="font-semibold text-red-600 hover:text-red-800 transition-colors">Logout</button>
            </div>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Your Details</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm font-medium text-gray-500">Full Name</label>
                            <p id="staff-profile-name" class="text-lg font-semibold text-gray-800">-</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-500">Role</label>
                            <p id="staff-profile-role" class="text-lg font-semibold text-gray-800 capitalize">-</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-500">Assigned Vehicle</label>
                            <p id="staff-profile-vehicle" class="text-lg font-semibold text-gray-800">-</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Today's Route Assignment</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm font-medium text-gray-500">Route</label>
                            <p id="staff-profile-route-name" class="text-lg font-semibold text-gray-800">-</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-500">Start / End Point</label>
                            <p id="staff-profile-route-points" class="text-lg font-semibold text-gray-800">-</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-500">Shift Time</label>
                            <p id="staff-profile-shift-time" class="text-lg font-semibold text-gray-800">08:00 AM -
                                05:00 PM</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-500">Daily Rounds</label>
                            <p id="staff-profile-rounds" class="text-lg font-semibold text-gray-800">8</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-500">Fare Rate</label>
                            <p id="staff-profile-fare" class="text-lg font-semibold text-gray-800">₹1.50 / km</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, getDocs, writeBatch, onSnapshot, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // --- Mock Data for Initial Seeding ---
        const MOCK_ROUTES_DATA = [{ id: 'route-101', name: 'Route 101', color: '#EF4444', stops: [{ id: 's1', name: 'Central Station', latlng: { latitude: 12.9716, longitude: 77.5946 } }, { id: 's2', name: 'City Market', latlng: { latitude: 12.9698, longitude: 77.5771 } }, { id: 's3', name: 'Tech Park', latlng: { latitude: 12.9592, longitude: 77.6412 } }, { id: 's4', name: 'Greenwood Colony', latlng: { latitude: 12.9345, longitude: 77.6261 } },], }, { id: 'route-202', name: 'Route 202', color: '#3B82F6', stops: [{ id: 's5', name: 'University Campus', latlng: { latitude: 13.0359, longitude: 77.5970 } }, { id: 's6', name: 'General Hospital', latlng: { latitude: 13.0076, longitude: 77.5731 } }, { id: 's7', name: 'Shopping Mall', latlng: { latitude: 12.9719, longitude: 77.6412 } }, { id: 's8', name: 'Old Town', latlng: { latitude: 12.9840, longitude: 77.5970 } },], }, { id: 'route-303', name: 'Route 303', color: '#10B981', stops: [{ id: 's9', name: 'Airport Shuttle', latlng: { latitude: 13.1989, longitude: 77.7068 } }, { id: 's10', name: 'Highway Junction', latlng: { latitude: 13.0840, longitude: 77.6420 } }, { id: 's11', name: 'Business Bay', latlng: { latitude: 13.0100, longitude: 77.6600 } },], },];
        const MOCK_BUS_DATA = { 'bus-alpha': { vehicleNumber: 'KA01F1234', routeId: 'route-101', latlng: { latitude: 12.9705, longitude: 77.5850 } }, 'bus-beta': { vehicleNumber: 'KA02F5678', routeId: 'route-101', latlng: { latitude: 12.9450, longitude: 77.6330 } }, 'bus-gamma': { vehicleNumber: 'KA03F9012', routeId: 'route-202', latlng: { latitude: 13.0210, longitude: 77.5850 } }, 'bus-delta': { vehicleNumber: 'KA04F3456', routeId: 'route-303', latlng: { latitude: 13.1500, longitude: 77.7000 } }, };

        // --- App State and Firebase ---
        let auth, db, map;
        let busMarkers = {};
        let routeLayer = null;
        let authMode = 'login'; // 'login' or 'signup'
        let busToFocus = null;
        let authRole = 'traveller'; // This is new

        const firebaseConfig = {
            apiKey: "AIzaSyClxS9biWWFSGS5KXrYnMosppM_8NUdhpI",
            authDomain: "transitiq-a692e.firebaseapp.com",
            projectId: "transitiq-a692e",
            storageBucket: "transitiq-a692e.firebasestorage.app",
            messagingSenderId: "981132917090",
            appId: "1:981132917090:web:cd7e816a0f49ff176c543b",
            measurementId: "G-8XQPXTBDHP"
        };

        const app = initializeApp(firebaseConfig);
        auth = getAuth(app);
        db = getFirestore(app);

        // --- DOM Elements ---
        const screens = { loading: document.getElementById('loading-screen'), home: document.getElementById('home-screen'), auth: document.getElementById('auth-screen'), map: document.getElementById('map-screen'), profile: document.getElementById('profile-screen'), 'book-tickets': document.getElementById('book-tickets-screen'), 'find-transport': document.getElementById('find-transport-screen'), 'track-vehicle': document.getElementById('track-vehicle-screen'), 'staff-profile': document.getElementById('staff-profile-screen') };
        const authEmailInput = document.getElementById('auth-email');
        const authPasswordInput = document.getElementById('auth-password');
        const authFullnameInput = document.getElementById('auth-fullname');
        const authConfirmPasswordInput = document.getElementById('auth-confirm-password');
        const authVehicleNumberInput = document.getElementById('auth-vehicle-number'); // This is new
        const authErrorMessage = document.getElementById('auth-error-message');
        const authSubmitBtn = document.getElementById('auth-submit-btn');
        const authSubmitText = document.getElementById('auth-submit-text');
        const authLoader = document.getElementById('auth-loader');


        // --- Screen Navigation ---
        function showScreen(screenName) {
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            if (screens[screenName]) screens[screenName].classList.remove('hidden');
        }

        // --- App Initialization ---
        onAuthStateChanged(auth, async (user) => {
            const homeLoginBtn = document.getElementById('home-login-btn');
            const homeProfileBtn = document.getElementById('home-profile-btn');

            if (user) {
                const staffDocRef = doc(db, "staff", user.uid);
                const staffDocSnap = await getDoc(staffDocRef);

                if (staffDocSnap.exists()) {
                    document.getElementById('home-profile-name').textContent = 'Staff Dashboard';
                } else {
                    document.getElementById('home-profile-name').textContent = user.displayName || 'My Profile';
                }
                homeLoginBtn.classList.add('hidden');
                homeProfileBtn.classList.remove('hidden');
            } else {
                homeLoginBtn.classList.remove('hidden');
                homeProfileBtn.classList.add('hidden');
            }
            showScreen('home');
            screens.loading.classList.add('hidden');
        });
        function loadStaffProfileData(user, staffData) {
            document.getElementById('staff-profile-name').textContent = user.displayName || 'N/A';
            document.getElementById('staff-profile-role').textContent = staffData.role;
            document.getElementById('staff-profile-vehicle').textContent = staffData.vehicleNumber;

            // Mock finding assigned route
            const assignedRoute = MOCK_ROUTES_DATA[0]; // Assigning the first route for demo
            document.getElementById('staff-profile-route-name').textContent = assignedRoute.name;
            const startPoint = assignedRoute.stops[0].name;
            const endPoint = assignedRoute.stops[assignedRoute.stops.length - 1].name;
            document.getElementById('staff-profile-route-points').textContent = `${startPoint} to ${endPoint}`;
        }

        // --- Map Logic ---
        function initMap() {
            if (map) return; // Prevent re-initialization
            map = L.map('map', { zoomControl: false }).setView([12.9716, 77.5946], 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { attribution: 'CARTO' }).addTo(map);
        }

        async function loadMapData() {
            const routesCol = collection(db, 'routes');
            const busesCol = collection(db, 'buses');
            const routeSnapshot = await getDocs(routesCol);
            if (routeSnapshot.empty) {
                console.log('Seeding initial data...');
                const batch = writeBatch(db);
                MOCK_ROUTES_DATA.forEach(route => batch.set(doc(routesCol, route.id), route));
                Object.entries(MOCK_BUS_DATA).forEach(([id, data]) => batch.set(doc(busesCol, id), data));
                await batch.commit();
            }
            const routes = (await getDocs(routesCol)).docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderRouteButtons(routes);
            onSnapshot(busesCol, (snapshot) => {
                const busesData = {};
                snapshot.forEach(doc => { busesData[doc.id] = doc.data(); });
                updateBusMarkers(busesData);
            });
            // Populate dropdowns for booking tickets
            const allStops = MOCK_ROUTES_DATA.flatMap(route => route.stops);
            const fromStopSelect = document.getElementById('from-stop');
            const toStopSelect = document.getElementById('to-stop');
            fromStopSelect.innerHTML = '<option>Select starting point</option>';
            toStopSelect.innerHTML = '<option>Select destination</option>';
            allStops.forEach(stop => {
                fromStopSelect.innerHTML += `<option value="${stop.name}">${stop.name}</option>`;
                toStopSelect.innerHTML += `<option value="${stop.name}">${stop.name}</option>`;
            });
        }

        function renderRouteButtons(routes) {
            const container = document.getElementById('route-buttons');
            container.innerHTML = '';
            routes.forEach(route => {
                const button = document.createElement('button');
                button.className = `flex-shrink-0 text-white font-bold py-2 px-4 rounded-full shadow-md`;
                button.style.backgroundColor = route.color;
                button.textContent = route.name;
                button.onclick = () => {
                    if (routeLayer) map.removeLayer(routeLayer);
                    routeLayer = L.layerGroup();
                    L.polyline(route.stops.map(s => [s.latlng.latitude, s.latlng.longitude]), { color: route.color, weight: 5 }).addTo(routeLayer);
                    route.stops.forEach(stop => L.marker([stop.latlng.latitude, stop.latlng.longitude], { icon: L.divIcon({ className: 'bus-stop-icon-div' }) }).bindPopup(stop.name).addTo(routeLayer));
                    routeLayer.addTo(map);
                    const coordinates = route.stops.map(stop => [stop.latlng.latitude, stop.latlng.longitude]);
                    if (coordinates.length > 0) map.flyToBounds(coordinates, { padding: [50, 50] });
                };
                container.appendChild(button);
            });
        }

        function updateBusMarkers(buses) {
            Object.entries(buses).forEach(([busId, bus]) => {
                const busIconHtml = `<div class="bus-icon-div"><svg height="22" width="22" viewBox="0 0 512 512" fill="#4285F4"><path d="M448 64h-16v-16c0-26.51-21.49-48-48-48h-192c-26.51 0-48 21.49-48 48v16h-16c-35.344 0-64 28.656-64 64v256c0 35.344 28.656 64 64 64h16v16c0 26.51 21.49 48 48 48h192c26.51 0 48-21.49 48-48v-16h16c35.344 0 64-28.656 64-64v-256c0-35.344-28.656-64-64-64zm-288-16c0-8.824 7.176-16 16-16h192c8.824 0 16 7.176 16 16v16h-224v-16zm256 320c0 8.824-7.176 16-16 16h-192c-8.824 0-16-7.176-16-16v-16h224v16zm64-64c0 17.641-14.359 32-32 32h-320c-17.641 0-32-14.359-32-32v-256c0-17.641 14.359-32 32-32h320c17.641 0 32 14.359 32 32v256z"/><circle cx="144" cy="272" r="32" fill="#fff"/><circle cx="368" cy="272" r="32" fill="#fff"/></svg></div>`;
                const customIcon = L.divIcon({ html: busIconHtml, className: '', iconSize: [36, 36], iconAnchor: [18, 18], });
                if (busMarkers[busId]) {
                    busMarkers[busId].setLatLng([bus.latlng.latitude, bus.latlng.longitude]);
                } else {
                    busMarkers[busId] = L.marker([bus.latlng.latitude, bus.latlng.longitude], { icon: customIcon }).addTo(map);
                }
            });

            if (busToFocus && buses[busToFocus.id]) {
                const routeOfBus = MOCK_ROUTES_DATA.find(r => r.id === busToFocus.routeId);
                if (routeOfBus) {
                    const routeButtonContainer = document.getElementById('route-buttons');
                    const routeButton = Array.from(routeButtonContainer.children).find(btn => btn.textContent === routeOfBus.name);
                    if (routeButton) routeButton.click();
                    map.flyTo([busToFocus.latlng.latitude, busToFocus.latlng.longitude], 16);
                }
                busToFocus = null;
            }
        }

        function setAuthLoading(isLoading) {
            if (isLoading) {
                authSubmitText.classList.add('hidden');
                authLoader.classList.remove('hidden');
                authSubmitBtn.disabled = true;
            } else {
                authSubmitText.classList.remove('hidden');
                authLoader.classList.add('hidden');
                authSubmitBtn.disabled = false;
            }
        }

        function showAuthError(message) {
            authErrorMessage.textContent = message;
            authErrorMessage.classList.remove('hidden');
        }

        // --- Event Listeners and Animation Setup---
        document.addEventListener('DOMContentLoaded', () => {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('is-visible');
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.animate-on-scroll').forEach(el => observer.observe(el));
            document.querySelectorAll('.faq-question').forEach(q => {
                q.addEventListener('click', () => {
                    const answer = q.nextElementSibling;
                    const icon = q.querySelector('span');
                    if (answer.style.maxHeight) {
                        answer.style.maxHeight = null;
                        icon.style.transform = 'rotate(0deg)';
                    } else {
                        answer.style.maxHeight = answer.scrollHeight + "px";
                        icon.style.transform = 'rotate(180deg)';
                    }
                });
            });

            document.getElementById('home-login-btn').addEventListener('click', () => showScreen('auth'));

            document.querySelectorAll('.feature-card-btn').forEach(btn => btn.addEventListener('click', (e) => {
                const targetScreen = e.target.dataset.target;
                if (auth.currentUser) {
                    if (targetScreen === 'map') busToFocus = null;
                    showScreen(targetScreen);
                    if (targetScreen === 'map' || targetScreen === 'book-tickets') {
                        initMap();
                        loadMapData();
                    }
                } else {
                    showScreen('auth');
                }
            }));
            document.getElementById('auth-back-btn').addEventListener('click', () => showScreen('home'));
            document.getElementById('map-home-btn').addEventListener('click', () => showScreen('home'));
            document.getElementById('map-profile-btn').addEventListener('click', () => showScreen('profile'));
            document.getElementById('home-profile-btn').addEventListener('click', async () => {
                const user = auth.currentUser;
                if (!user) return;

                screens.loading.classList.remove('hidden');
                const staffDocRef = doc(db, "staff", user.uid);
                const staffDocSnap = await getDoc(staffDocRef);

                if (staffDocSnap.exists()) {
                    loadStaffProfileData(user, staffDocSnap.data());
                    showScreen('staff-profile');
                } else {
                    document.getElementById('profile-name').textContent = user.displayName || 'N/A';
                    document.getElementById('profile-email').textContent = user.email;
                    showScreen('profile');
                }
                screens.loading.classList.add('hidden');
            });
            // Role Toggle Logic
            document.querySelectorAll('.role-toggle-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.role-toggle-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    authRole = btn.dataset.role;
                    updateAuthForm();
                });
            });

            // Logout from Staff Profile
            document.getElementById('staff-profile-logout-btn').addEventListener('click', () => signOut(auth));
            document.getElementById('profile-back-btn').addEventListener('click', () => showScreen('home'));
            document.getElementById('tickets-back-btn').addEventListener('click', () => showScreen('home'));
            document.getElementById('find-transport-back-btn').addEventListener('click', () => showScreen('home'));
            document.getElementById('track-vehicle-back-btn').addEventListener('click', () => showScreen('home'));
            document.getElementById('profile-logout-btn').addEventListener('click', () => signOut(auth));
            document.getElementById('track-vehicle-find-route-btn').addEventListener('click', () => showScreen('find-transport'));

            document.getElementById('auth-toggle-btn').addEventListener('click', () => {
                authMode = authMode === 'login' ? 'signup' : 'login';
                const signupFields = document.querySelectorAll('.signup-fields');
                document.getElementById('auth-title').textContent = authMode === 'login' ? 'Welcome Back' : 'Create Account';
                authSubmitText.textContent = authMode === 'login' ? 'Log In' : 'Sign Up';
                const toggleText = document.getElementById('auth-toggle-btn').firstElementChild;
                toggleText.innerHTML = authMode === 'login' ? "Don't have an account? <span class='font-bold text-white'>Sign Up</span>" : "Already have an account? <span class='font-bold text-white'>Log In</span>";

                if (authMode === 'signup') {
                    signupFields.forEach(el => el.classList.add('expanded'));
                } else {
                    signupFields.forEach(el => el.classList.remove('expanded'));
                }
                authErrorMessage.classList.add('hidden');
                authEmailInput.value = '';
                authPasswordInput.value = '';
                authFullnameInput.value = '';
                authConfirmPasswordInput.value = '';
            });

            authSubmitBtn.addEventListener('click', async () => {
                const email = authEmailInput.value;
                const password = authPasswordInput.value;
                const fullname = authFullnameInput.value;
                const confirmPassword = authConfirmPasswordInput.value;

                authErrorMessage.classList.add('hidden');
                setAuthLoading(true);

                try {
                    if (authMode === 'login') {
                        if (!email || !password) throw new Error("Please fill in all fields.");
                        await signInWithEmailAndPassword(auth, email, password);
                    } else { // Signup
                        if (!fullname || !email || !password || !confirmPassword) throw new Error("Please fill in all fields.");
                        if (password !== confirmPassword) throw new Error("Passwords do not match.");
                        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        await updateProfile(userCredential.user, { displayName: fullname });

                        if (authRole === 'driver' || authRole === 'conductor') {
                            if (!vehicleNumber) throw new Error("Vehicle number is required for staff.");
                            await setDoc(doc(db, "staff", userCredential.user.uid), {
                                role: authRole,
                                vehicleNumber: vehicleNumber.toUpperCase()
                            });
                        }
                    }

                } catch (error) {
                    let friendlyMessage = "An unexpected error occurred.";
                    switch (error.code) {
                        case 'auth/email-already-in-use': friendlyMessage = "This email is already registered."; break;
                        case 'auth/wrong-password': friendlyMessage = "Incorrect password. Please try again."; break;
                        case 'auth/user-not-found': friendlyMessage = "No account found with this email."; break;
                        case 'auth/invalid-email': friendlyMessage = "Please enter a valid email address."; break;
                        case 'auth/weak-password': friendlyMessage = "Password should be at least 6 characters."; break;
                    }
                    if (error.message === "Please fill in all fields." || error.message === "Passwords do not match.") {
                        friendlyMessage = error.message;
                    }
                    showAuthError(friendlyMessage);
                } finally {
                    setAuthLoading(false);
                }
            });

            document.getElementById('track-vehicle-submit-btn').addEventListener('click', async () => {
                const vehicleNumberInput = document.getElementById('vehicle-number-input');
                const vehicleNumber = vehicleNumberInput.value.trim().toUpperCase();
                const resultsDiv = document.getElementById('track-vehicle-results');
                resultsDiv.innerHTML = '';

                if (!vehicleNumber) {
                    resultsDiv.innerHTML = `<p class="text-red-500">Please enter a vehicle number.</p>`;
                    return;
                }

                const busesCol = collection(db, 'buses');
                const q = query(busesCol, where("vehicleNumber", "==", vehicleNumber));

                try {
                    const querySnapshot = await getDocs(q);
                    if (querySnapshot.empty) {
                        resultsDiv.innerHTML = `<p class="text-red-500">Vehicle not found. Please check the number and try again.</p>`;
                    } else {
                        const busDoc = querySnapshot.docs[0];
                        busToFocus = { id: busDoc.id, ...busDoc.data() };
                        showScreen('map');
                        initMap();
                        loadMapData();
                    }
                } catch (e) {
                    console.error("Error searching for vehicle:", e);
                    resultsDiv.innerHTML = `<p class="text-red-500">An error occurred while searching. Please try again later.</p>`;
                }
            });

            document.getElementById('search-buses-btn').addEventListener('click', () => {
                const resultsDiv = document.getElementById('ticket-results');
                resultsDiv.innerHTML = `<div class="mt-4 p-4 border rounded-lg bg-gray-50"><h3 class="font-bold">2 Buses Found</h3><p class="text-gray-600">Route 101 - Departs at 09:30 AM</p><p class="text-gray-600">Route 202 - Departs at 09:45 AM</p></div>`;
            });
            document.getElementById('find-routes-btn').addEventListener('click', () => {
                const resultsDiv = document.getElementById('find-transport-results');
                resultsDiv.innerHTML = `<div class="mt-4 p-4 border rounded-lg bg-gray-50"><h3 class="font-bold">Route 101 is the best option.</h3><p class="text-gray-600">Duration: ~25 mins</p><p class="text-gray-600">Fare: $2.50</p></div>`;
            });

        });

        function updateAuthForm() {
            const signupFields = document.getElementById('signup-fields');
            const signupConfirmField = document.getElementById('signup-fields-confirm');
            const staffFields = document.getElementById('staff-fields');
            const authTitle = document.getElementById('auth-title');
            const authSubmitText = document.getElementById('auth-submit-text');
            const toggleText = document.getElementById('auth-toggle-btn').firstElementChild;

            if (authMode === 'signup') {
                authTitle.textContent = 'Create Account';
                authSubmitText.textContent = 'Sign Up';
                toggleText.innerHTML = "Already have an account? <span class='font-bold text-white'>Log In</span>";
                signupFields.classList.add('expanded');
                signupConfirmField.classList.add('expanded');

                if (authRole === 'driver' || authRole === 'conductor') {
                    staffFields.classList.add('expanded');
                } else {
                    staffFields.classList.remove('expanded');
                }
            } else { // Login Mode
                authTitle.textContent = 'Welcome Back';
                authSubmitText.textContent = 'Log In';
                toggleText.innerHTML = "Don't have an account? <span class='font-bold text-white'>Sign Up</span>";
                signupFields.classList.remove('expanded');
                signupConfirmField.classList.remove('expanded');
                staffFields.classList.remove('expanded');
            }
        }
    </script>
</body>

</html>